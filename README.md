# 音響シミュレーションシステム

## 概要

本プロジェクトは、部屋間の音響特性をシミュレーションし、可視化するWebアプリケーションです。主な機能として、音源から受音室までの音圧レベルの変化、A特性重み付け、等ラウドネス曲線の表示などを提供します。

### 主な機能

- 音源のパワーレベルから受音室の音圧レベルまでの計算
- 部屋の吸音特性の考慮（グラスウール、ロックウールなど）
- 壁の遮音性能の計算
- A特性重み付けの計算と表示
- 等ラウドネス曲線上でのプロット
- 各段階での音の再生機能

## 必要要件

- Python 3.8以上
- 必要なパッケージは`requirements.txt`に記載

## セットアップ

1. リポジトリをクローン
```bash
git clone [repository-url]
```

2. 必要なパッケージのインストール
```bash
pip install -r requirements.txt
```

## 使用方法

1. アプリケーションの起動
```bash
python app.py
```

2. ブラウザで以下のURLにアクセス
```
http://localhost:5001
```

3. パラメータの設定
   - 周波数（125Hz～4000Hz）
   - 音源パワーレベル
   - 天井材料の選択（材質、密度、厚さ、空気層）
   - パネル材料の選択（材質、密度、厚さ、空気層）
   - 壁の設定（厚さ、ドアの状態）

## コードの説明

### アプリケーション関連

#### `app.py`
Flaskを使用したWebアプリケーションのメインファイルです。
- 吸音率データベース（グラスウール、ロックウール等）の定義
- 透過損失データベースの定義
- 音響計算のエンドポイント（/calculate）
- 音声再生のエンドポイント（/play-sound）
- 静的ファイル配信の設定

#### `sound.py`
音声生成と再生を担当するクラスを提供します。
- `SoundGenerator`クラス：正弦波の生成と再生
- サンプリングレートの設定（44.1kHz）
- 音量制御と振幅変換
- ハニング窓関数による音声の平滑化

### 音響計算関連

#### `sound_insulation.py`
音響計算の核となる関数群を提供します。
- 透過損失の計算
- 総合透過率の計算
- 乱入射透過損失の計算
- Sabineの式による残響時間計算
- 総合吸音率の計算

#### `loudA.py`
A特性重み付けの計算と可視化を行います。
- A特性フィルタの実装
- 周波数重み付け曲線の描画
- 指定周波数でのA特性値の計算

### 等ラウドネス曲線関連

#### `plot.py`
等ラウドネス曲線の描画と推定を行います。
- 複数点による等ラウドネス曲線の推定
- ISO 226:2003規格に基づく曲線描画
- 補間による推定曲線の生成

#### `fit_curve.py`
1点を通る等ラウドネス曲線の推定を行います。
- コマンドライン引数による入力
- 等ラウドネス曲線の補間計算
- グラフ描画と保存

#### `loudness.py`
等ラウドネス曲線の静的な描画を行います。
- ISO 226:2003規格に基づく曲線の描画
- 10フォン刻みでの曲線生成
- 高解像度画像としての保存

#### `loud_data.py`
等ラウドネス曲線のデータ処理を担当します。
- CSVファイルからのデータ読み込み
- 10フォン刻みでのデータ補間
- 完成データの保存

### 実行ファイル

#### `exe.py`
音響計算のメイン実行ファイルです。
- 材料選択のインタラクティブなインターフェース
- 音響計算の実行フロー制御
- 結果の表示と保存

### フロントエンド

#### `templates/index.html`
Webアプリケーションのフロントエンドです。
- レスポンシブなユーザーインターフェース
- 材料選択フォーム
- リアルタイムな計算結果の表示
- グラフと音声再生の統合

#### `static/image/diagram.jpg`
音響シミュレーションの概念図を提供します。

### データファイル

#### `data/`ディレクトリ
等ラウドネス曲線の基礎データを含みます。
- 0〜100フォンの等ラウドネス曲線データ
- ISO 226:2003規格に基づくデータ
- 補間済みの完全なデータセット

#### `output/`ディレクトリ
計算結果の出力先です。
- 等ラウドネス曲線のプロット
- A特性重み付けグラフ
- 各種計算結果のグラフ

## 実装の詳細

### 音響計算の流れ
1. 音源のパワーレベルの設定
2. 音源室の吸音力の計算
3. 音源室の平均音圧レベルの計算
4. 壁面の透過率計算
5. 受音室の吸音力計算
6. 受音室の音圧レベル計算
7. A特性重み付けの適用
8. 等ラウドネス曲線上へのプロット

### 使用している理論式
- 透過損失：TL = -10 log₁₀(τ)
- 吸音力：A = Σ(α_i × S_i)
- 残響時間：T = 0.16V/A
- A特性重み付け：規格化された周波数応答曲線
- 等ラウドネス：ISO 226:2003規格に基づく計算

### データ構造
- 吸音率データベース：多層的な辞書構造
- 透過損失データ：材料ごとの周波数特性
- 等ラウドネス曲線：周波数とdBのペアデータ

## 補足情報

### 計算の制限事項
- 周波数範囲：125Hz〜4000Hz
- 音圧レベル範囲：0〜130dB
- 材料：グラスウール、ロックウール、コンクリート等の一般的な建材

### 精度と検証
- 理論値に基づく計算
- ISO規格に準拠した等ラウドネス曲線
- 実測値との誤差は考慮が必要

### 将来の拡張性
- 新しい建材データの追加
- より広い周波数範囲への対応
- 3次元音場シミュレーションへの拡張

---

ご不明な点や詳細な説明が必要な箇所がありましたら、お気軽にお問い合わせください。